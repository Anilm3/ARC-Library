<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ARC-Library: Coding conventions</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ARC-Library
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('page_coding.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Coding conventions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Coding conventions play a very important role in software development and have always been a sort of controversy between programmers. One of tha main reasons to have a set of coding conventions is to decrease the likelihood of bugs, but also it has been shown that the human brain is very efficient at decoding known patterns, thus having a standard style throughout an entire code base can increase its readibility.</p>
<p>Even though I really like some of the features of C99, I am trying to make ARC ANSI C compatible to allow it to be used on different architectures where compilers might no have yet kept up with the new standards, so suffice it to say that those features which are not in ANSI C are not allowed. For most of the coding conventions described here I've followed some of the most famous coding style guides (<a class="el" href="page_coding.html#section_ref">References</a>), much of it is copied from them but there is also some of my own personal preferences.</p>
<p>Before understanding what all the coding conventions are about, it is important to understand the design principles behind the ARC library:</p>
<ul>
<li><b> Binary compatibility:</b></li>
<li><b> Robustness:</b></li>
<li><b> Reliability:</b></li>
<li><b> Reusability:</b></li>
<li><b> Portability:</b></li>
</ul>
<h2><a class="anchor" id="section_code_structure"></a>
Code structure</h2>
<p>To provide binary compatibility the opaque pointer pattern is used, keeping the structure definitions hidden and providing functions to allocate, initialize and deallocate the required structures. In order to do so, each structure is defined in a [name]_def.h file in the source directory, the exposed interface is defined in [name].h in the include directory and the implementation is located in [name].c in the source directory. This also provides internal reusability with minimal heap memory usage, as internal ARC modules are allowed to use ARC structures through stack allocations.</p>
<div class="fragment"><pre class="fragment">
               +-------+                        
     +---------+  ARC  +--------+               
     |         +-------+        |               
     |                          |               
 +---+---+                  +---+---+           
 |include|                  |  src  |           
 +---+---+                  +---+---+           
     |                          |               
+----+----+                +----+----+          
|component|             +--+component+--+       
+----+----+             |  +---------+  |       
     |                  |               |       
 +---+----+      +------+-----+     +---+----+  
 |[name].h|      |[name]_def.h|     |[name].c|  
 +---+----+      +------+-----+     +----+---+  
</pre></div><p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_indentation"></a>
Indentation</h2>
<p>Indentations in ARC are 4 spaces, clear and simple. Tabs are not allowed, other sized indentations are not allowed. There is no specific reason for this decision, in fact it's a matter of personal preference, 2 spaces is too small, 8 spaces is just too big considering that all of the names in the library have to be "namespaced" (arc_[name]). Regarding tabs, there is no clean way to provide multi-line alignment when using tabs, as the size is fixed. Some people claim that tabs provide less memory usage, but considering we're in the TB era, there is no need for this sort of premature optimization.</p>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_code_size"></a>
Breaking lines and strings</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_braces_spaces"></a>
Placing Braces</h2>
<p>For braces, the Allman style is the preferred option as it gives a more clear separation of the different blocks in the code:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (condition)
{
    action 1;
    action 2;
}
</pre></div><p>It is mandatory to add braces to every control structure except those without a body; control structures with one statement are no exception to this rule: </p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
{
    only one action;
}

<span class="keywordflow">while</span> (i != n);
</pre></div><p><a class="el" href="page_coding.html">Back to top</a> <hr/>
<h2><a class="anchor" id="section_spaces"></a>
Spacing</h2>
<p>Spacing is required after most of the control structures keywords: if, switch, case, for, do, while. E.g.:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">for</span> (i = 0; i &lt; n; i++)
{
    action;
}

<span class="keywordflow">switch</span> (condition)
{
<span class="keywordflow">case</span> value:
    <span class="keywordflow">break</span>;
<span class="keywordflow">default</span>:
}

<span class="keywordflow">if</span> (condition)
{
    action;
}
</pre></div><p>Do not add spaces around (inside) parenthesized expressions. An example of what not to do would be:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> ( condition )
{
    action;
}
</pre></div><p>Use one space around (on each side of) most binary and ternary operators, such as any of these:</p>
<div class="fragment"><pre class="fragment">    =  +  -  &lt;  &gt;  *  /  %  |  &amp;  ^  &lt;=  &gt;=  ==  !=  ?  :
</pre></div><p>but no space after unary operators: </p>
<div class="fragment"><pre class="fragment">    &amp;  *  +  -  ~  !  <span class="keyword">sizeof</span>  typeof  alignof  __attribute__  defined
</pre></div><p>no space before the postfix increment &amp; decrement unary operators: </p>
<div class="fragment"><pre class="fragment">    ++  --
</pre></div><p>no space after the prefix increment &amp; decrement unary operators: </p>
<div class="fragment"><pre class="fragment">    ++  --
</pre></div><p>and no space around the <code></code>'.' and <code></code>"-&gt;" structure member operators.</p>
<p>When declaring pointer data or a function that returns a pointer type, the preferred use of '*' is adjacent to the data name or function name and not adjacent to the type name. E.g.:</p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> *variable;
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv);
<span class="keywordtype">void</span> *malloc(<span class="keywordtype">size_t</span>);
</pre></div><p>Do not leave trailing whitespace at the ends of lines.</p>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
<h2><a class="anchor" id="section_naming"></a>
Naming</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_types"></a>
Typedefs</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_function"></a>
Functions</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_exit"></a>
Centralized exiting of functions</h2>
<p>The goto statement is allowed when a function exits from multiple locations and some common work such as cleanup has to be done. If there is no cleanup needed then there is no justification to use the goto statement.</p>
<p>The rationale is:</p>
<ul>
<li>unconditional statements are easier to understand and follow</li>
<li>nesting is reduced</li>
<li>errors by not updating individual exit points when making modifications are prevented</li>
<li>saves the compiler work to optimize redundant code away</li>
</ul>
<div class="fragment"><pre class="fragment"><span class="keywordtype">int</span> fun(<span class="keywordtype">int</span> a)
{
    <span class="keywordtype">int</span> result = 0;
    <span class="keywordtype">char</span> *buffer = malloc(SIZE);

    <span class="keywordflow">if</span> (buffer == NULL)
    {
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (condition1)
    {
        <span class="keywordflow">while</span> (loop1)
        {
            ...
        }
        
        result = 1;
        
        <span class="keywordflow">goto</span> out;
    }

    ...

out:
    free(buffer);
    <span class="keywordflow">return</span> result;
}
</pre></div><p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_comments"></a>
Commenting</h2>
<ul>
<li>Comments are very important, but it's also importanto to write self-commenting code, i.e. code that is clear enough to be understood without the need of comments.</li>
<li>Comments are allowed in functions or outside of them, but it is usually more convenient to have a set of comments outside the function explaining what it does, but not necessarily how it does it. In many cases the hows can be left for documentation.</li>
<li>Since ARC has to be ANSI C compliant only the following comment style is allowed:</li>
</ul>
<div class="fragment"><pre class="fragment">
/* Comment line 1 */
</pre></div><ul>
<li>Multiline comments should have the following style:</li>
</ul>
<div class="fragment"><pre class="fragment">
/*
 * Comment line 1
 * Comment line 2
 */
</pre></div><p> <a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_reference_count"></a>
Reference counting</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_inline_static"></a>
Static &amp; inline functions</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_return"></a>
Return values</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 <h2><a class="anchor" id="section_constants"></a>
Defining constants</h2>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
<h2><a class="anchor" id="section_ref"></a>
References</h2>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/CodingStyle">https://www.kernel.org/doc/Documentation/CodingStyle</a></li>
<li><a href="https://github.com/git/git/blob/master/Documentation/CodingGuidelines">https://github.com/git/git/blob/master/Documentation/CodingGuidelines</a></li>
<li><a href="http://www.gnu.org/prep/standards/standards.html">http://www.gnu.org/prep/standards/standards.html</a></li>
<li><a href="http://www.barrgroup.com/Embedded-Systems/How-To/More-Bug-Killing-Standards-for-Embedded-C">http://www.barrgroup.com/Embedded-Systems/How-To/More-Bug-Killing-Standards-for-Embedded-C</a></li>
<li><a href="http://www.barrgroup.com/Embedded-Systems/How-To/Bug-Killing-Standards-for-Embedded-C">http://www.barrgroup.com/Embedded-Systems/How-To/Bug-Killing-Standards-for-Embedded-C</a></li>
<li><a href="http://en.wikipedia.org/wiki/Indent_style">http://en.wikipedia.org/wiki/Indent_style</a></li>
</ul>
<p><a class="el" href="page_coding.html">Back to top</a> <hr/>
 </div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">ARC Library Documentation</a>      </li>

    <li class="footer">Generated on Sat Sep 19 2015 23:20:24 for ARC-Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
